# üåç Geoserver

Une fois les pr√©dictions faites, il est important de les int√©grer au [Geoserver](https://geoserver-satellite-images.lab.sspcloud.fr/geoserver) *(demander les identifiants √† l'√©quipe)*.

---

## üì• √âtape 1 : Envoi vers le pvc du GeoServer via ArgoWorkflow

Un remplissage dans le pvc du GeoServer se fait directement lors de l‚Äô[inf√©rence via le template ArgoWorkflow](https://github.com/InseeFrLab/satellite-images-inference/blob/9c9ef808fdce7ecea29a568e04c41354258c3c61/argo-workflows/predict-workflows.yaml#L86).  
Cette √©tape consiste √† stocker les images Pl√©iades **et** les pr√©dictions dans le GeoServer.

---

## üóÇÔ∏è √âtape 2 : Cr√©ation manuelle des entrep√¥ts et couches dans le GeoServer

Il est important de cr√©er un entrep√¥t et une couche pour utiliser les donn√©es sous forme de flux WMS dans la webapp.
Pour l‚Äôinstant, **cette √©tape est manuelle** : nous n‚Äôavons pas trouv√© de m√©thode automatique.

---

## üì∑ Pour les *Images*

1. **Entrep√¥t**  
   - Menu **Donn√©es > Entrep√¥ts** (√† gauche)  
   - Cliquez sur **+ Ajouter un nouvel entrep√¥t**  
   - Choisir **ImageMosaic**  
   - `name = <DEP>_<YEAR>`  
   - Parcourir le dossier `PLEIADES/<DEP>/<YEAR>`  
   - ‚û°Ô∏è *Sauvegarder*

2. **Couche**  
   - Menu **Donn√©es > Couches**  
   - Cliquez sur **+ Ajouter une nouvelle couche**  
   - S√©lectionner l‚Äôentrep√¥t cr√©√©  
   - `name = <DEP>_<YEAR>`, `title = <YEAR>`  
   - ‚û°Ô∏è *Sauvegarder*

---

## üß† Pour les *Pr√©dictions*

1. **Entrep√¥t**  
   - Menu **Donn√©es > Entrep√¥ts**  
   - Cliquez sur **+ Ajouter un nouvel entrep√¥t**  
   - Choisir **Geopackage**  
   - `name = <DEP>_PREDICTIONS_<YEAR>`  
   - Parcourir le fichier :  
     `PREDICTIONS/PLEIADES/<DEP>/<YEAR>/Segmentation-multiclasse/1/predictions.gpkg`  
   - ‚û°Ô∏è *Sauvegarder*

2. **Couche**  
   - Menu **Donn√©es > Couches**  
   - Cliquez sur **+ Ajouter une nouvelle couche**  
   - S√©lectionner l‚Äôentrep√¥t cr√©√©  
   - `name = <DEP>_PREDICTIONS_<YEAR>`, `title = <DEP>_PREDICTIONS_<YEAR>`  
   - Dans l‚Äôonglet **Emprises** :  
     - Cliquer sur **Bas√©es sur les donn√©es**, puis **Calculer depuis les emprises natives**  
   - Dans **Publication > Style par d√©faut** : `dirag:style_multiclass`  
   - ‚û°Ô∏è *Sauvegarder*

---

‚ö†Ô∏è **V√©rification**  
Pour v√©rifier que tout s'est bien pass√© :  
Menu **Pr√©visualisation de la couche** (√† gauche) ‚Üí Cliquer sur **OpenLayers** de la couche souhait√©e pour la pr√©visualiser.

---

# üß© Webapp CRaTT

Une fois les nouvelles couches cr√©√©es, il faut les int√©grer dans la webapp CRaTT :  

1. Cloner le [d√©p√¥t Git](https://github.com/InseeFrLab/satellite-images-webapp.git)  
2. Modifier le code pour ajouter le nouveau **couple D√©partement / Ann√©e** :  
   - Dans [`components/config.js`](https://github.com/InseeFrLab/satellite-images-webapp/blob/main/src/components/config.js)  
   - Et dans [`utils/config.js`](https://github.com/InseeFrLab/satellite-images-webapp/blob/main/src/utils/config.js)  

üí° Le `git push` d√©clenche automatiquement un rebuild du site. Les nouvelles couches seront visibles apr√®s quelques minutes (une fois que l‚Äôaction GitHub est termin√©e).

---
